@model Scandimex.Models.Cotizaciones

@{
    ViewBag.Title = "Edit";
}

<h2>Editar</h2>

<link rel="stylesheet" href="//code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css">
<script src="//code.jquery.com/jquery-1.10.2.js"></script>
<script src="//code.jquery.com/ui/1.11.1/jquery-ui.js"></script>
@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)

    <fieldset>
        <legend>Cotizaciones</legend>

        @Html.HiddenFor(model => model.CotizacionId)


        <table>
            <tr>
                <td>
                    <div class="editor-label">
                        @Html.LabelFor(model => model.CodigoInterno)
                    </div>
                    <div class="editor-field">
                        @Html.EditorFor(model => model.CodigoInterno)
                        @Html.ValidationMessageFor(model => model.CodigoInterno)
                    </div>
                </td>
                <td>
                    <div class="editor-label">
                        @Html.LabelFor(model => model.FechaCotizacion)
                    </div>
                    <div class="editor-field">
                        @Html.TextBoxFor(model => model.FechaCotizacion, "{0:MM/dd/yyyy}", new { @class = "datepicker" })
                        @Html.ValidationMessageFor(model => model.FechaCotizacion)
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="editor-label">
                        @Html.LabelFor(model => model.IdCliente)
                    </div>
                    <div id="DivCliente" class="form-group">
                        <div class="col-md-10">
                            @Html.DropDownListFor(model => model.IdCliente, new SelectList(ViewBag.Clientes, "IdCliente", "NombreCompañia"))

                            @Html.ValidationMessageFor(model => model.IdCliente, "Debe seleccionar algun Cliente.")
                        </div>
                    </div>
                </td>
                <td></td>
            </tr>
            <tr>
                <td>
                    <div class="editor-label">
                        @Html.LabelFor(model => model.Requerido)
                    </div>
                    <div class="editor-field">
                        @Html.TextAreaFor(model => model.Requerido)
                        @Html.ValidationMessageFor(model => model.Requerido)
                    </div>
                </td>
                <td>
                    <div class="editor-label">
                        @Html.LabelFor(model => model.Descripcion)
                    </div>
                    <div class="editor-field">
                        @Html.TextAreaFor(model => model.Descripcion)
                        @Html.ValidationMessageFor(model => model.Descripcion)
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="editor-label">
                        @Html.LabelFor(model => model.PlazoEntregaDesde)
                    </div>
                    <div class="editor-field">
                        @Html.TextBoxFor(model => model.PlazoEntregaDesde, "{0:MM/dd/yyyy}", new { @class = "datepicker" })
                        @Html.ValidationMessageFor(model => model.PlazoEntregaDesde)
                    </div>
                </td>
                <td>
                    <div class="editor-label">
                        @Html.LabelFor(model => model.PlazoEntregaHasta)
                    </div>
                    <div class="editor-field">
                        @Html.TextBoxFor(model => model.PlazoEntregaHasta, "{0:MM/dd/yyyy}", new { @class = "datepicker" })
                        @Html.ValidationMessageFor(model => model.PlazoEntregaHasta)
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="editor-label">
                        @Html.LabelFor(model => model.Garantia)
                    </div>
                    <div class="editor-field">
                        @Html.EditorFor(model => model.Garantia)
                        @Html.ValidationMessageFor(model => model.Garantia)
                    </div>
                </td>
                <td>
                    <div class="editor-label">
                        @Html.LabelFor(model => model.CondicionesPago)
                    </div>
                    <div class="editor-field">
                        @Html.EditorFor(model => model.CondicionesPago)
                        @Html.ValidationMessageFor(model => model.CondicionesPago)
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="editor-label">
                        @Html.LabelFor(model => model.PaisAbreviacion)
                    </div>
                    <div class="col-md-10">
                        @Html.DropDownListFor(model => model.PaisAbreviacion, new SelectList(ViewBag.Paises, "PaisAbreviacion", "PaisNombre"))

                        @Html.ValidationMessageFor(model => model.PaisAbreviacion, "Debe seleccionar algun pais.")
                    </div>
                </td>
                <td>
                    <div class="editor-label">
                        @Html.LabelFor(model => model.CiudadCodigo)
                    </div>

                    <div class="form-group">
                        <div class="col-md-10">
                            @Html.DropDownListFor(model => model.CiudadCodigo, new SelectList(String.Empty, "CiudadCodigo", "CiudadNombre"), "-- Select --")

                            @Html.ValidationMessageFor(model => model.CiudadCodigo, "Debe seleccionar alguna ciudad.")
                            <span id="states-loading-progress" style="display: none;">Please wait..</span>
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="editor-label">
                        @Html.LabelFor(model => model.Direccion)
                    </div>
                    <div class="editor-field">
                        @Html.EditorFor(model => model.Direccion)
                        @Html.ValidationMessageFor(model => model.Direccion)
                    </div>
                </td>
                <td>
                    <div class="editor-label">
                        @Html.LabelFor(model => model.Validez)
                    </div>
                    <div class="editor-field">
                        @Html.EditorFor(model => model.Validez)
                        @Html.ValidationMessageFor(model => model.Validez)
                    </div>
                </td>
            </tr>
            <tr>
                <td>

                    <div class="editor-label">
                        @Html.LabelFor(model => model.Aceptacion)
                    </div>
                    <div class="editor-field">
                        @Html.EditorFor(model => model.Aceptacion)
                        @Html.ValidationMessageFor(model => model.Aceptacion)
                    </div>
                </td>
                <td></td>
            </tr>
        </table>

        <br />


        @if (Model.CotizacionId == 0)
        {
            int _id = Model.CotizacionId;
        }

        <div>
            <h3>Productos</h3>
            @Html.ActionLink("Nuevo producto", "Create", "CotizacionProducto", new { _id = Model.CotizacionId }, null)
            <br />
            @if (ViewBag.CotProductos != null)
                {
                <table>
                    <tr>
                        <td>@Html.Label("Tipo Producto")  &nbsp;&nbsp; </td>
                        <td>@Html.Label("Sub Producto")  &nbsp;&nbsp; </td>
                        <td>@Html.Label("Sub Categoría") &nbsp;&nbsp; </td>
                        <td>@Html.Label("Descripción") &nbsp;&nbsp; </td>
                        <td>@Html.Label("Valor Unitario") &nbsp;&nbsp; </td>
                        <td>@Html.Label("Cantidad") &nbsp;&nbsp; </td>
                        <td>@Html.Label("Total") &nbsp;&nbsp; </td>
                    </tr>

                    @foreach (var item in ViewBag.CotProductos)
                    {
                        <tr>
                            <td>@item.TipoProductos.NombreTipoProducto</td>
                            <td>@item.TipoProductoSub.NombreSubCategoria</td>
                            <td>@item.SubCategoría</td>
                            <td>@item.Descripcion</td>
                            <td>@item.ValorUnitario</td>
                            <td>@item.Cantidad</td>
                            <td>@item.ValorFinal</td>
                            <td>
                                @Html.ActionLink("Edi", "Edit", "CotizacionProducto", new { _id = (Int32)@item.CotProdId, _IdCotizacion = Model.CotizacionId }, null) |
                                @Html.ActionLink("Det", "Details", "CotizacionProducto", new { _id = (Int32)@item.CotProdId, _IdCotizacion = Model.CotizacionId }, null) |
                                @Html.ActionLink("Del", "Delete", "CotizacionProducto", new { _id = (Int32)@item.CotProdId, _IdCotizacion = Model.CotizacionId }, null)
                            </td>
                        </tr>
                    }
                </table>
            }
            else
            {
                <h3>Esta cotización no tiene productos asociados.</h3>
            }

        </div>
        <div>
            <h3>Servicios</h3>
            @Html.ActionLink("Nuevo servicio", "Create", "CotizacionServicio", new { _id = Model.CotizacionId }, null)
            <br />
            @if (ViewBag.CotServicios != null)
                {
                <table>
                    <tr>
                        <td>@Html.Label("Tipo Servicio")  &nbsp;&nbsp; </td>
                        <td>@Html.Label("Sub Categoría")  &nbsp;&nbsp; </td>
                        <td>@Html.Label("Descripción") &nbsp;&nbsp; </td>
                        <td>@Html.Label("Horas de Servicio") &nbsp;&nbsp; </td>
                        <td>@Html.Label("Valor Hora") &nbsp;&nbsp; </td>
                        <td>@Html.Label("Total") &nbsp;&nbsp; </td>
                    </tr>

                    @foreach (var item in ViewBag.CotServicios)
                    {
                        <tr>
                            <td>@item.TipoServicio.NombreTipoServicio</td>
                            <td>@item.SubCategoría</td>
                            <td>@item.Descripcion</td>
                            <td>@item.HorasServicio</td>
                            <td>@item.ValorHora</td>
                            <td>@item.ValorFinal</td>
                            <td>
                                @Html.ActionLink("Edi", "Edit", "CotizacionServicio", new { _id = (Int32)@item.CotServId, _IdCotizacion = Model.CotizacionId }, null) |
                                @Html.ActionLink("Det", "Details", "CotizacionServicio", new { _id = (Int32)@item.CotServId, _IdCotizacion = Model.CotizacionId }, null) |
                                @Html.ActionLink("Del", "Delete", "CotizacionServicio", new { _id = (Int32)@item.CotServId, _IdCotizacion = Model.CotizacionId }, null)
                            </td>
                        </tr>
                    }
                </table>
            }
            else
            {
                <h3>Esta cotización no tiene servicios asociados.</h3>
            }
        </div>

        <br />
        <p>
            <input type="submit" value="Save" />
        </p>
    </fieldset>
}

<div>
    @Html.ActionLink("Vuelta a la Lista de Cotizaciones", "Index")
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <script type="text/jscript">

        $(function () {
            $("#PaisAbreviacion").change(function () {
                var selectedItem = $(this).val();
                var ddlCitys = $("#CiudadCodigo");
                var statesProgress = $("#states-loading-progress");
                statesProgress.show();

                var str;
                $("#PaisAbreviacion option:selected").each(function () {
                    str = $(this).val();
                })

                $.ajax({
                    cache: false,
                    type: "GET",
                    url: "@(Url.Action("ObtenerCiudad"))",
                    data: { "_CodigoPais": str },
                    success: function (data) {
                        ddlCitys.html('');

                        $.each(data, function (id, option) {
                            ddlCitys.append($('<option></option>').val(option.CiudadCodigo).html(option.CiudadNombre));
                        });

                        statesProgress.hide();
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        alert('Failed to retrieve states.');
                        statesProgress.hide();
                    }
                });
            });

            $("#PaisAbreviacion").change();
            $("#IdCliente").change();
            $('.FechaCotizacion').datepicker();
            $('.PlazoEntregaDesde').datepicker();
            $('.PlazoEntregaHasta').datepicker();

            $('.datepicker').datepicker();
            $("#datepicker").datepicker();
        });

    </script>
}
